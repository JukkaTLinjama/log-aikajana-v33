# History at Log Scale — README (v33b)

> Tämä on **v33b**-sarjan README. Dokumentti kuvaa rakenteen, tärkeimmät säätökohdat ja kehitysvinkit lyhyesti.
> *kommentti:* pidetty tiiviinä ja käytännönläheisenä, jotta copy/paste on helppoa.

---

## Sisältö
- `index.html` – runko ja SVG-kontti
- `style.css` – värit, typografia, akselin ja zoombarin tyylit
- `timeline.js` – skaala, piirtologiikka, zoom/pan, kortit
- `eventsDB.json` – tapahtumadata

---

## Käyttö
1) Aja kevyt dev-palvelin (esim. VS Code Live Server / `python3 -m http.server`).
2) Avaa `index.html` selaimessa.

*kommentti:* suoralla tiedostopolulla osa selaimista blokkaa fontti- ja fetch-pyynnöt.

---

## Pääideat

### Logaritminen aika-akseli
- Y-akseli = log10( **vuodet nykyhetkestä taaksepäin** ).
- Pienemmät arvot ylhäällä (esim. `10^-1` = 0.1 v ~ 36 vrk).

**Säätö – domain datasta marginaalein** (`timeline.js`):
```js
// computeDomainFromData()
const padTopDec = 0.15; // "ilmaa" ylös (pienempi minYears)
const padBotDec = 0.20; // "ilmaa" alas (isompi maxYears)
state.minYears = Math.max(1e-8, minData / 10**padTopDec);
state.maxYears = maxData * 10**padBotDec;
```
- Kiinteän yläpään saat tarvittaessa: `state.minYears = 1e-1; // 0.1 v`

### Akseli & apuviivat (v32-tyyli)
- **Numerot vain major-tickeissä** (10ⁿ).
- **Apuviivat haaleammat** ja **CSS:stä**:
```css
.axis .tick.minor line { stroke:#aaa; stroke-opacity:.35; }
.axis .tick.major line { stroke:#ccc; stroke-opacity:.7;  }
```
- Tick-merkit vasemmalle: `d3.axisLeft(y).tickSize(6)` ja minor-linjat `x1:-6, x2:0`.

### Minor-viivat erillisessä kerroksessa
- `.minor-grid` piirtää 2..9×10ⁿ -viivat vain kun näkymä ei ole liian tiheä.
- *kommentti:* näin minor-viivat eivät “katoa” teksti-ehdoista.

### Kortit
- Kortin `rect` pituus = varsinainen eventtialue + **dynaamiset padit**:
  - yläpadi = otsikon bbox + marginaali
  - alapadi = rivikorkeus × kerroin (tilaa alimman eventin alle)
- **Sticky-otsikko:** pysyy yläreunassa, mutta **piiloutuu** jos koko kortti on ulkona näkyvistä.

### Zoom & pan
- ZoomBar = kapea pystykisko oikealla.
- **Ikkuna** (`.window`) on visuaalinen, **hitbox** (`.hit`) hoitaa dragin.
- Kerrosjärjestys varmistetaan `setZOrder()`-kutsulla.

### Aktiivinen kortti (highlight)
- Kerrokset: **passiivinen sisältö (`gRoot`) → overlay (`gDim`) → aktiivinen (`gActive`)**.
- Klikkaus asettaa `state.activeTheme`; **vain yksi** kortti nostetaan `gActive`-ryhmään.
- Overlayn leveys = **pelkkä plot-alue**, ei akselia/zoombaria.
```css
.global-dim-rect{ fill:#000; opacity:0; pointer-events:none; transition:opacity .12s; }
```
```js
dimRect.style("opacity", state.activeTheme ? 0.45 : 0);
```

---

## Tyylit ja typografia
- Tapahtumateksti serif: 
```css
.event-label { 
  fill:#dedede; font-family:Georgia, "Times New Roman", serif; 
  font-size:9px; letter-spacing:.1px;
}
@media (max-width:480px){ .event-label{ font-size:8px; } }
```

---

## Säätölistä (pikaviitteet)
- Yläraja esim. **0.1 v**: `state.minYears = 1e-1;` (tai `ONE_DAY_YEARS`).
- Minor-viivojen kynnys: `visibleDecades <= 12` → nosta jos haluat enemmän minoreita.
- Vasemman väliaks.gap: `axisGap` (overlay ei peitä akselia).

---

## Tunnetut kulmat
- **Oikean reunan harmaa palkki** (sporadinen) — tutkitaan myöhemmin.
- DevTools-resize: käytä `ResizeObserver`iä ajamaan `layout()` + `applyZoom()`.

---

## Lisenssi
- © 2025 JL — CC BY 4.0 (kuten UI-footerissa).

---

## Changelog (tiivis)
- v32: akseli vain major-numerot, minor-viivat haaleina (CSS), sticky-otsikko.
- v33b: refaktorointi & dokumentaatio; domain datasta + padit, zoombar kerrosjärjestys selkeytetty, overlay-arkkitehtuuri valmiina. 
- (uudemmissa kokeiluissa v36…): aktiivikortti & globaali overlay, dynaamiset padit, vasen tick, overscroll, clip-bleed.
